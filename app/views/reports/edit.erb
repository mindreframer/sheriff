<%= form_for @report do |f| %>
  <table>
    <% Report::NESTED_VALIDATIONS.each do |validation_name| %>
      <tr <%= error_attribute(@report) %>>
        <% @report.send(validation_name) or @report.send("build_#{validation_name}") %>
        <%= f.fields_for validation_name.to_sym do |validation_form| %>
          <% validation = validation_form.object %>
          <td><%= check_box_with_label "report[#{validation_name}_attributes][active]", false, !validation.new_record?, validation_name.to_s.camelcase.sub('Validation','') %></td>
          <td>
            <% case validation
               when ValueValidation %>
              <%= validation_form.text_field :value_as_text %>
            <% when RunEveryValidation %>
              <%= validation_form.text_field :interval_value %>
              <%= validation_form.select :interval_unit, time_units_for_select %>
            <% when RunBetweenValidation %>
              <%= validation_form.text_field :start_hms %>
              <%= validation_form.text_field :end_hms %>
            <% end %>
          </td>
          <td>warn via <%= validation_form.select :error_level, [['Ignore', 0], ['Log', 1], ['Email', 2], ['Sms', 3]] %></td>
        <% end %>
      </tr>
    <% end %>
  </table>
  <%= f.submit %>
<% end %>

<h3>Values</h3>
<table>
  <tr>
    <th>Value</th>
    <th>Reported at</th>
  </tr>
  <% @report.historic_values_including_current.each do |historic_value| %>
    <tr <%= error_attribute(historic_value) %>>
      <td><%= historic_value.value %></td>
      <td><%= detailed_time historic_value.reported_at %></td>
    </tr>
  <% end %>
</table>
