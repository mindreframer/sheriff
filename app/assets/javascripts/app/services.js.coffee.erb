# http://docs.angularjs.org/#!angular.service *

<%# here only basic routes, extend, if needed! %>
<% generic_controllers = Sheriff::EXPOSED_MODELS.map{|x| x[:model]}-['Settings'] %>
<% generic_controllers.map{|x| x.pluralize.downcase}.each do |m| %>
angular.service('<%= m.humanize %>', ($resource)->
 $resource('<%= m %>/:id/:action', { id: '@<%= m.singularize %>.id', action: '@action'},
                'index':  { method: 'GET', isArray: true, params:{page:1} },
                'show':   { method: 'GET' },
                'create': { method: 'POST' },
                'update': {
                  method: 'PUT'
                  action: 'update',
                  isArray: false
                },
                <%# save ($save) is an important method for Resouces, changed from POST to PUT,  %>
                'save': {
                  method:'PUT',
                  action: 'update',
                  isArray: false
                },
                'destroy': {
                  method: 'DELETE',
                  action: 'destroy',
                  isArray: false
                }
          );
);
<% end %>

angular.service('Settings', ($resource)->
 $resource('settings', {},
                  { 'index': { method: 'GET' }});
);

# service for all models
<% plural_models = Sheriff::EXPOSED_MODELS.map{|x| x[:model]}.map{|x| x.pluralize} %>
angular.service('models', (<%= plural_models.join(',')  %>)->
  result = {}
  <% plural_models.each do |m| %>
  result.<%= m %> = <%= m %>
  <% end %>
  result
)
