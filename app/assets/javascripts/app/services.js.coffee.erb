# http://docs.angularjs.org/#!angular.service *

<%# here only basic routes, extend, if needed! %>
<% generic_controllers = Sheriff::EXPOSED_MODELS.map{|x| x[:model]}-['Settings'] %>
<% generic_controllers.map{|x| x.pluralize.downcase}.each do |m| %>
angular.service('<%= m.humanize %>', ($resource)->
 $resource('<%= m %>/:id/:action', { id: '@id', action: '@action'},
                'index':  { method: 'GET', isArray: true, params:{page:1} },
                'show':   { method: 'GET' },
                'create': { method: 'POST' },
                'update': {
                  method: 'PUT'
                  isArray: false
                },
                <%# save ($save) is an important method for Resouces, changed from POST to PUT,  %>
                'save': {
                  method:'PUT',
                  isArray: false
                },
                'destroy': {
                  action: 'destroy',
                  isArray: false
                }
          );
);
<% end %>

angular.service('Settings', ($resource)->
 $resource('settings', {},
                  { 'index': { method: 'GET' }});
);

# service for all models
<% plural_models = Sheriff::EXPOSED_MODELS.map{|x| x[:model]}.map{|x| x.pluralize} %>
angular.service('models', (<%= plural_models.join(',')  %>)->
  result = {}
  <% plural_models.each do |m| %>
  result.<%= m %> = <%= m %>
  <% end %>
  result
)


angular.service('routes',  ($routeParams)->
  self = @
  <% plural_models.each do |m| %>
  self.<%= m.downcase %>CompleteUrl = (params)->
    "#/<%= m.downcase %>?#{angular.toKeyValue(params)}"

  self.<%= m.downcase %>IndexUrl = ()->
    self.<%= m.downcase %>CompleteUrl()

  self.<%= m.downcase %>EditUrl = (object)->
    self.<%= m.downcase %>CompleteUrl(id: object.id, action: 'edit')

  self.<%= m.downcase %>ShowUrl = (object)->
    @<%= m.downcase %>CompleteUrl(id: object.id, action: 'show')

  self.<%= m.downcase %>DestroyUrl = (object)->
    self.<%= m.downcase %>CompleteUrl(id: object.id, action: 'destroy')

  self.<%= m.downcase %>NextUrl = ()->
    params      = angular.copy($routeParams)
    params.page ?= 1
    params.page = parseInt(params.page) + 1
    self.<%= m.downcase %>CompleteUrl(params)

  self.<%= m.downcase %>PrevUrl = ()->
    params      = angular.copy($routeParams)
    params.page ?= 1
    params.page = parseInt(params.page) - 1
    self.<%= m.downcase %>CompleteUrl(params)


  <% end %>
  self
)
